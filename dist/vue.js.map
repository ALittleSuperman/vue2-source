{"version":3,"file":"vue.js","sources":["../src/observe/array.js","../src/observe/index.js","../src/state.js","../src/complie/index.js","../src/init.js","../src/index.js"],"sourcesContent":["// 重写数组中的部分函数\n\n// 获取数组的原型\nconst oldArrayProto = Array.prototype\n\n// 创建新原型，修改新原型函数，不会影响原生函数\nexport const newArrayProto = Object.create(oldArrayProto)\n\n// 以下函数会改变原数组\nconst method = [\n    \"push\",\n    \"pop\",\n    \"shift\",\n    \"unshift\",\n    \"revers\",\n    \"sort\",\n    \"splice\",\n]\n\nmethod.forEach(method => {\n    newArrayProto[method] = function (...args) {\n        // 重写数组的方法，内部调用原来的函数\n       const result = oldArrayProto[method].call(this, ...args)\n\n        // 保存修改数组的数据\n        let inserted\n        let ob = this.__ob__\n        switch (method) {\n            case \"push\":\n            case \"unshift\":\n                inserted = args\n                break\n            case \"spice\":\n                inserted = args.slice(2)\n        }\n        console.log(inserted)\n        if (inserted) {\n            // 将新数据进行劫持\n            ob.observeArray(inserted)\n        }\n        return result\n    }\n})\n\n\n","import {newArrayProto} from \"./array\";\n\nclass Observe {\n    constructor(data) {\n        // 添加属性偏于数据监听，并且如果数据上有__ob__属性说明已经被观测过\n        // 将__ob__设置成不可枚举，防止将大当成object循环劫持\n        Object.defineProperty(data, '__ob__', {\n            value: this,\n            enumerable: false\n        })\n        // 数组不使用劫持函数，因为数组的数量是不固定的，循环起来消耗性能\n        // 重写数组的7个修改数组本身的函数\n        if(Array.isArray(data)) {\n            // 对数组中的object数据类型进行劫持\n            data.__proto__ = newArrayProto\n            this.observeArray(data)\n        } else {\n            // 不是数组进行劫持\n            this.walk(data)\n        }\n    }\n\n    /**\n     * 循环对象,依次劫持\n     * @param data\n     */\n    walk(data) {\n        Object.keys(data).forEach(key => defineReactive(data, key, data[key]))\n    }\n\n    /**\n     * 劫持数组中的object类型数据\n     * @param data\n     */\n    observeArray(data) {\n        data.forEach(item => observe(item))\n    }\n}\n\n/**\n * 属性劫持\n * @param target 要劫持的目标\n * @param key 要劫持的key\n * @param value key的valve\n * @returns {*}\n */\nexport function defineReactive(target, key , value) {\n    observe(value) // 对所有属性都进行数据劫持,深度劫持\n    Object.defineProperty(target, key, {\n        get() {\n            return value\n        },\n        set(newVal) {\n            if (newVal === value) return\n            value = newVal\n        }\n    })\n}\n\nexport function observe(data) {\n    if (typeof data !== 'object' || data === null) return\n    // 如果已经被劫持过，那就不需要劫持了\n    if (data.__ob__ instanceof Observe) return data.__ob__\n    // 如果数据上有__ob__属性说明已经被劫持过\n    return new Observe(data)\n}","import {observe} from \"./observe\";\n\nexport function initState(vm) {\n    const opts = vm.$options // 获取所有选项\n    if (opts.data) {\n        initData(vm)\n    }\n}\n\n// 代理\nfunction proxy(vm, target, key) {\n    Object.defineProperty(vm, key, {\n        get() {\n            return vm[target][key]\n        },\n        set(newVal) {\n            vm[target][key] = newVal\n        }\n    })\n}\n\nfunction initData(vm) {\n    let data = vm.$options.data\n    data = typeof data === 'function' ? data.call(vm) : data\n\n    vm._data = data\n    // 使用defineProperty 劫持数据\n    observe(data)\n\n    // vm代理vm._data方便取值\n   for(let key in data) {\n       proxy(vm, '_data', key)\n   }\n}\n","\n// 模版编译函数\nexport function compileToFunction(template) {\n    // 1。将template转换成ast语法树\n\n    // 2。生成render函数（render函数执行后返回虚拟dom）\n    console.log(template)\n}","import {initState} from \"./state\";\nimport {compileToFunction} from \"./complie\";\n\n\nexport function initMixin(Vue) {\n    Vue.prototype._init = function (options) {\n        const vm = this\n        vm.$options = options // 挂载共享配置\n\n        // 初始化状态\n        initState(vm)\n\n        // 处理模版\n        if(options.el) {\n            vm.$mount(options.el)\n        }\n    }\n    Vue.prototype.$mount = function (el) {\n        const vm = this\n        el = document.querySelector(el)\n        const opts = vm.$options\n        // 先进行查找render\n        if (!opts.render) {\n            // 如果不存在render函数，查看有没有template参数\n            let template\n            if(!opts.template && el) {\n                // 没有template属性使用挂载容器内的模版\n                template = el.outerHTML\n            } else  {\n                if (el) {\n                    // 存在template属性就使用传入的template属性模版\n                    template = opts.template\n                }\n            }\n            if (template) {\n                // 编译模版\n                const render = compileToFunction(template)\n                opts.render = render\n            } else {\n                console.warn(\"没有模版信息\")\n            }\n        }\n        opts.render\n    }\n}\n\n","import { initMixin } from \"./init\";\n\nfunction Vue(options) {\n    this._init(options)\n}\ninitMixin(Vue)\n\nexport default Vue"],"names":["oldArrayProto","Array","prototype","newArrayProto","Object","create","method","forEach","args","result","call","inserted","ob","__ob__","slice","console","log","observeArray","Observe","data","defineProperty","value","enumerable","isArray","__proto__","walk","keys","key","defineReactive","item","observe","target","get","set","newVal","initState","vm","opts","$options","initData","proxy","_data","compileToFunction","template","initMixin","Vue","_init","options","el","$mount","document","querySelector","render","outerHTML","warn"],"mappings":"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"}